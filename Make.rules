# === DEFAULT MAKE RULES ===
# 
# Must be defined:
# 	- OBJS		=> *.bin dependencies
# 	- ENTRY		=> Entry point for the linker [Make.defaults]
#
# Defined by Make.defaults:
#	- CC
#	- CFLAGS
#	- LD
#	- LFLAGS
#	- AS
#	- AFLAGS
#	- ARCH

include $(PWD)/Make.defaults

%.o: %.c
	$(CC) $(CFLAGS) -o $@ $<

%.o: %.$(ASEXT)
	$(CPP) $(CPPFLAGS) $< | $(AS) $(AFLAGS) -o $@

# *.generated.ld rules must be manually specified as dependencies
%.generated.ld: %.ld
	$(CPP) $(CPPFLAGS) $< | grep -v '^#' > $@

# *.bin files serve as Kernel Modules, and shouldn't contain anything besides
# the target file's basename.
%.bin:
	$(MAKE) $(OBJS)
	$(LD) $(LFLAGS) -o $@ $(OBJS)


.DEFAULT_GOAL = all