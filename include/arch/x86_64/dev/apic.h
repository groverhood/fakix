#ifndef KERNEL_ARCH_X86_64_APIC_H
#define KERNEL_ARCH_X86_64_APIC_H 1

#include <stdint.h>
#include <attributes.h>
#include <fakix/vspace.h>

packed align(16) struct apic_register {
    uint32_t value;
    uint32_t pad[3];
};

#define LAPIC_BASE ((volatile struct apic_register *)(0xFEE00000 + VSPACE_KERN_BASE))
#define LAPIC_REGISTER(X) (&(LAPIC_BASE + (X / sizeof *LAPIC_BASE))->value)

#define LAPIC_ID_REGISTER LAPIC_REGISTER(0x0020)
#define LAPIC_VERSION_REGISTER LAPIC_REGISTER(0x0030)
#define LAPIC_TASK_PRIORITY_REGISTER LAPIC_REGISTER(0x0080)
#define LAPIC_ARBITRATION_PRIORITY_REGISTER LAPIC_REGISTER(0x0090)
#define LAPIC_PROCESSOR_PRIORITY_REGISTER LAPIC_REGISTER(0x00A0)
#define LAPIC_EOI_REGISTER LAPIC_REGISTER(0x00B0)
#define LAPIC_REMOTE_READ_REGISTER LAPIC_REGISTER(0x00C0)
#define LAPIC_LOGICAL_DESTINATION_REGISTER LAPIC_REGISTER(0x00D0)
#define LAPIC_DESTINATION_FORMAT_REGISTER LAPIC_REGISTER(0x00E0)
#define LAPIC_SPIRV_REGISTER LAPIC_REGISTER(0x00F0)
#define LAPIC_IN_SERVICE_REGISTER_31_0 LAPIC_REGISTER(0x0100)
#define LAPIC_IN_SERVICE_REGISTER_63_32 LAPIC_REGISTER(0x0110)
#define LAPIC_IN_SERVICE_REGISTER_95_64 LAPIC_REGISTER(0x0120)
#define LAPIC_IN_SERVICE_REGISTER_127_96 LAPIC_REGISTER(0x0130)
#define LAPIC_IN_SERVICE_REGISTER_159_128 LAPIC_REGISTER(0x0140)
#define LAPIC_IN_SERVICE_REGISTER_191_160 LAPIC_REGISTER(0x0150)
#define LAPIC_IN_SERVICE_REGISTER_223_192 LAPIC_REGISTER(0x0160)
#define LAPIC_IN_SERVICE_REGISTER_255_224 LAPIC_REGISTER(0x0170)
#define LAPIC_TRIGGER_MODE_REGISTER_31_0 LAPIC_REGISTER(0x0180)
#define LAPIC_TRIGGER_MODE_REGISTER_63_32 LAPIC_REGISTER(0x0190)
#define LAPIC_TRIGGER_MODE_REGISTER_95_64 LAPIC_REGISTER(0x01A0)
#define LAPIC_TRIGGER_MODE_REGISTER_127_96 LAPIC_REGISTER(0x01B0)
#define LAPIC_TRIGGER_MODE_REGISTER_159_128 LAPIC_REGISTER(0x01C0)
#define LAPIC_TRIGGER_MODE_REGISTER_191_160 LAPIC_REGISTER(0x01D0)
#define LAPIC_TRIGGER_MODE_REGISTER_223_192 LAPIC_REGISTER(0x01E0)
#define LAPIC_TRIGGER_MODE_REGISTER_255_224 LAPIC_REGISTER(0x01F0)
#define LAPIC_INT_REQUEST_REGISTER_31_0 LAPIC_REGISTER(0x0200)
#define LAPIC_INT_REQUEST_REGISTER_63_32 LAPIC_REGISTER(0x0210)
#define LAPIC_INT_REQUEST_REGISTER_95_64 LAPIC_REGISTER(0x0220)
#define LAPIC_INT_REQUEST_REGISTER_127_96 LAPIC_REGISTER(0x0230)
#define LAPIC_INT_REQUEST_REGISTER_159_128 LAPIC_REGISTER(0x0240)
#define LAPIC_INT_REQUEST_REGISTER_191_160 LAPIC_REGISTER(0x0250)
#define LAPIC_INT_REQUEST_REGISTER_223_192 LAPIC_REGISTER(0x0260)
#define LAPIC_INT_REQUEST_REGISTER_255_224 LAPIC_REGISTER(0x0270)
#define LAPIC_ERROR_STATUS_REGISTER LAPIC_REGISTER(0x0280)
#define LAPIC_LVT_CMCI_REGISTER LAPIC_REGISTER(0x02F0)
#define LAPIC_INTERRUPT_CMD_REGISTER_31_0 LAPIC_REGISTER(0x0300)
#define LAPIC_INTERRUPT_CMD_REGISTER_63_32 LAPIC_REGISTER(0x0310)
#define LAPIC_LVT_TIMER_REGISTER LAPIC_REGISTER(0x0320)
#define LAPIC_LVT_THERMAL_SENSOR_REGISTER LAPIC_REGISTER(0x0330)
#define LAPIC_LVT_PERFORMANCE_MONITORING_COUNTERS_REGISTER LAPIC_REGISTER(0x340)
#define LAPIC_LVT_LINT0_REGISTER LAPIC_REGISTER(0x0350)
#define LAPIC_LVT_LINT1_REGISTER LAPIC_REGISTER(0x0360)
#define LAPIC_LVT_ERROR_REGISTER LAPIC_REGISTER(0x0370)
#define LAPIC_INITIAL_COUNT_REGISTER LAPIC_REGISTER(0x0380)
#define LAPIC_CURRENT_COUNT_REGISTER LAPIC_REGISTER(0x0390)
#define LAPIC_DIVIDE_CONFIGURATION_REGISTER LAPIC_REGISTER(0x03E0)

#endif